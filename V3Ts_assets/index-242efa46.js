import{d as J,W as ue,i as f,Y as ve,r,K as ne,o as m,g as U,w as a,h as e,c as w,F as K,f as O,u as I,S as W,a as E,x as B,t as me,y as N,R as oe,O as F,$ as y,N as H,_ as ee,m as fe,j as ge,Z as Se,Q as be,a0 as ye,X as ke,z as Z}from"./index-fffccacb.js";const Ve=["src"],Ae={name:"SpuForm"},Le=J({...Ae,emits:["changeShowPage"],setup(le,{expose:M,emit:G}){const V=ue();function D(n){n&&(u.value=n,u.value.spuSaleAttrList=[]),n!=null&&n.id?$(n.id):x()}function $(n){F(async()=>await Promise.all([y.product.spu.reqGetTrademarkList(),y.product.spu.reqSpuImageList(n),y.product.spu.reqSpuSaleAttrList(n),y.product.spu.reqBaseSaleAttrList()]),t=>{C.value=t[0],s.value=t[1].filter(d=>(d.name=d.imgName,d.url=d.imgUrl,!0)),u.value.spuSaleAttrList=t[2],R.value=t[3]})}function x(){F(async()=>await Promise.all([y.product.spu.reqGetTrademarkList(),y.product.spu.reqBaseSaleAttrList()]),n=>{C.value=n[0],R.value=n[1]})}const u=f({category3Id:void 0,createTime:void 0,description:void 0,id:void 0,spuImageList:void 0,spuName:void 0,spuPosterList:void 0,spuSaleAttrList:[],tmId:void 0,updateTime:void 0}),C=f(),R=f(),z=ve(()=>{var t;return((t=R.value)==null?void 0:t.filter(d=>{var k;return!((k=u.value.spuSaleAttrList)!=null&&k.find(X=>X.saleAttrName==d.name))}))||[]}),P=f();function S(){const[n,t]=P.value.split(":");u.value.spuSaleAttrList.push({baseSaleAttrId:n,saleAttrName:t,spuSaleAttrValueList:[]}),P.value=""}function i(n){u.value.spuSaleAttrList.splice(u.value.spuSaleAttrList.indexOf(n),1)}const l=f();function p(n){n.isInput=!0}function A(n,t){n.spuSaleAttrValueList.splice(n.spuSaleAttrValueList.indexOf(t),1)}function _(n){l.value&&(n.spuSaleAttrValueList.find(d=>d.saleAttrValueName==l.value)?H.error("属性值已存在"):n.spuSaleAttrValueList.push({baseSaleAttrId:n.baseSaleAttrId,saleAttrValueName:l.value,saleAttrName:n.saleAttrName})),l.value="",n.isInput=!1}const s=f([]),b=f(""),g=f(!1),L=(n,t)=>{n.code==200?s.value.splice(s.value.indexOf(t),1,{name:t.name,imgName:t.name,url:n.data,imgUrl:n.data,status:"success"}):s.value.splice(s.value.indexOf(t),1)},o=(n,t)=>{console.log(n,t)},q=n=>{b.value=n.url,g.value=!0};function v(n,t){u.value={category3Id:void 0,createTime:void 0,description:void 0,id:void 0,spuImageList:void 0,spuName:void 0,spuPosterList:void 0,spuSaleAttrList:[],tmId:void 0,updateTime:void 0},s.value=[],P.value="",G("changeShowPage",n,t)}function T(){u.value.category3Id||(u.value.category3Id=V.category.category3),u.value.spuImageList=s.value,F(()=>y.product.spu.reqAddAndUpdateSpu(u.value),async()=>{await H.success(u.value.id?"更新成功":"添加成功"),v(1,"reqInfo")})}return M({getParentData:D}),(n,t)=>{const d=r("el-input"),k=r("el-form-item"),X=r("el-option"),ae=r("el-select"),se=r("el-icon"),ie=r("el-upload"),re=r("el-dialog"),Q=r("el-button"),te=r("el-form"),Y=r("el-table-column"),de=r("el-tag"),ce=r("el-table"),pe=ne("my-focus");return m(),U(te,{inline:!1},{default:a(()=>[e(k,{label:"SPU名字"},{default:a(()=>[e(d,{modelValue:u.value.spuName,"onUpdate:modelValue":t[0]||(t[0]=c=>u.value.spuName=c),placeholder:"请输入SPU名字"},null,8,["modelValue"])]),_:1}),e(k,{label:"SPU品牌"},{default:a(()=>[e(ae,{modelValue:u.value.tmId,"onUpdate:modelValue":t[1]||(t[1]=c=>u.value.tmId=c),placeholder:"请选择的品牌",clearable:"",filterable:""},{default:a(()=>[(m(!0),w(K,null,O(C.value,(c,h)=>(m(),U(X,{key:h,label:c.tmName,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"SPU描述"},{default:a(()=>[e(d,{modelValue:u.value.description,"onUpdate:modelValue":t[2]||(t[2]=c=>u.value.description=c),type:"textarea",autosize:{minRows:3},placeholder:"请输入SPU描述"},null,8,["modelValue"])]),_:1}),e(k,{label:"SPU照片"},{default:a(()=>[e(ie,{"file-list":s.value,"onUpdate:fileList":t[3]||(t[3]=c=>s.value=c),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":q,"on-remove":o,"on-success":L},{default:a(()=>[e(se,null,{default:a(()=>[e(I(W))]),_:1})]),_:1},8,["file-list"]),e(re,{width:"700px",modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=c=>g.value=c)},{default:a(()=>[E("img",{style:{width:"100%"},src:b.value,alt:"图片展示失败"},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"SPU销售属性"},{default:a(()=>[e(te,{inline:!0},{default:a(()=>[e(k,null,{default:a(()=>{var c,h;return[e(ae,{modelValue:P.value,"onUpdate:modelValue":t[5]||(t[5]=j=>P.value=j),placeholder:((c=z.value)==null?void 0:c.length)>0?`还剩${(h=z.value)==null?void 0:h.length}可选`:"暂无数据展示",clearable:"",filterable:""},{default:a(()=>[(m(!0),w(K,null,O(z.value,(j,_e)=>(m(),U(X,{key:_e,label:j.name,value:`${j.id}:${j.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(Q,{style:{"margin-left":"15px"},disabled:!P.value,type:"primary",icon:I(W),onClick:S},{default:a(()=>[B("添加销售属性")]),_:1},8,["disabled","icon"])]}),_:1})]),_:1}),e(ce,{data:u.value.spuSaleAttrList,class:"table_css",border:"",stripe:""},{default:a(()=>[e(Y,{label:"序号",type:"index",width:"100",align:"center"}),e(Y,{label:"属性名",prop:"saleAttrName",width:"100"}),e(Y,{label:"属性值",prop:"spuSaleAttrValueList"},{default:a(({row:c})=>[(m(!0),w(K,null,O(c.spuSaleAttrValueList,h=>(m(),U(de,{style:{margin:"5px"},type:"danger",effect:"light",closable:"",onClose:j=>A(c,h)},{default:a(()=>[B(me(h.saleAttrValueName),1)]),_:2},1032,["onClose"]))),256)),c.isInput?N((m(),U(d,{key:1,modelValue:l.value,"onUpdate:modelValue":t[6]||(t[6]=h=>l.value=h),style:{width:"200px"},size:"small",clearable:"",onBlur:h=>_(c)},null,8,["modelValue","onBlur"])),[[pe]]):(m(),U(Q,{key:0,type:"primary",size:"small",icon:I(W),onClick:h=>p(c)},null,8,["icon","onClick"]))]),_:1}),e(Y,{label:"操作",width:"100"},{default:a(({row:c})=>[e(Q,{type:"danger",icon:I(oe),onClick:h=>i(c)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),e(Q,{type:"primary",onClick:T},{default:a(()=>[B("保存")]),_:1}),e(Q,{onClick:t[7]||(t[7]=c=>v(1))},{default:a(()=>[B("取消")]),_:1})]),_:1})]),_:1})}}});const he=ee(Le,[["__scopeId","data-v-96c90997"]]),Ue=["src"],xe={name:"SkuForm"},Ce=J({...xe,emits:["changeShowPage"],setup(le,{expose:M,emit:G}){function V(S,i,l){u.value.category3Id=l==null?void 0:l.category3Id,u.value.spuId=l==null?void 0:l.id,u.value.tmId=l==null?void 0:l.tmId,F(()=>Promise.all([y.product.attr.reqAttrInfoList(S,i,l.category3Id),y.product.spu.reqSpuImageList(l.id),y.product.spu.reqSpuSaleAttrList(l.id)]),p=>{D.value=p[0],x.value=p[1],$.value=p[2]})}const D=f([]),$=f([]),x=f([]),u=f({category3Id:"",spuId:"",tmId:"",id:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),C=f();function R(S){var i,l;(i=C.value)==null||i.clearSelection(),(l=C.value)==null||l.toggleRowSelection(S,!0),u.value.skuDefaultImg=S.imgUrl}function z(S,i){u.value={category3Id:"",spuId:"",tmId:"",id:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""},D.value=[],$.value=[],x.value=[],G("changeShowPage",S,i)}function P(){const S=D.value.reduce((l,p)=>{var A;if(p.sendData){const[_,s]=(A=p.sendData)==null?void 0:A.split(":");l.push({attrId:+_,valueId:+s})}return l},[]),i=$.value.reduce((l,p)=>{var A;if(p.sendData){const[_,s]=(A=p.sendData)==null?void 0:A.split(":");l.push({saleAttrId:+_,saleAttrValueId:+s})}return l},[]);u.value.skuAttrValueList=S,u.value.skuSaleAttrValueList=i,F(()=>y.product.spu.reqAddSku(u.value),async()=>{await H.success("添加成功"),z(1,"reqInfo")})}return M({getParentData:V}),(S,i)=>{const l=r("el-input"),p=r("el-form-item"),A=r("el-option"),_=r("el-select"),s=r("el-form"),b=r("el-table-column"),g=r("el-button"),L=r("el-table");return m(),U(s,{inline:!1,"label-width":"80px"},{default:a(()=>[e(p,{label:"SKU名字"},{default:a(()=>[e(l,{modelValue:u.value.skuName,"onUpdate:modelValue":i[0]||(i[0]=o=>u.value.skuName=o),placeholder:"SKU名字"},null,8,["modelValue"])]),_:1}),e(p,{label:"价格(元)"},{default:a(()=>[e(l,{modelValue:u.value.price,"onUpdate:modelValue":i[1]||(i[1]=o=>u.value.price=o),placeholder:"价格(元)",clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"重量(克)"},{default:a(()=>[e(l,{modelValue:u.value.weight,"onUpdate:modelValue":i[2]||(i[2]=o=>u.value.weight=o),placeholder:"重量(克)"},null,8,["modelValue"])]),_:1}),e(p,{label:"SKU描述"},{default:a(()=>[e(l,{modelValue:u.value.skuDesc,"onUpdate:modelValue":i[3]||(i[3]=o=>u.value.skuDesc=o),type:"textarea",autosize:{minRows:3},placeholder:"请输入SPU描述"},null,8,["modelValue"])]),_:1}),e(p,{label:"平台属性"},{default:a(()=>[e(s,{inline:!0,"label-width":"85px"},{default:a(()=>[(m(!0),w(K,null,O(D.value,(o,q)=>(m(),U(p,{key:q,label:o==null?void 0:o.attrName},{default:a(()=>[e(_,{modelValue:o.sendData,"onUpdate:modelValue":v=>o.sendData=v,placeholder:"请选择",clearable:"",filterable:""},{default:a(()=>[(m(!0),w(K,null,O(o==null?void 0:o.attrValueList,(v,T)=>(m(),U(A,{key:T,label:v==null?void 0:v.valueName,value:`${o==null?void 0:o.id}:${v==null?void 0:v.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"销售属性"},{default:a(()=>[e(s,{inline:!0,"label-width":"85px"},{default:a(()=>[(m(!0),w(K,null,O($.value,(o,q)=>(m(),U(p,{key:q,label:o==null?void 0:o.saleAttrName},{default:a(()=>[e(_,{modelValue:o.sendData,"onUpdate:modelValue":v=>o.sendData=v,placeholder:"请选择",clearable:"",filterable:""},{default:a(()=>[(m(!0),w(K,null,O(o==null?void 0:o.spuSaleAttrValueList,(v,T)=>(m(),U(A,{key:T,label:v==null?void 0:v.saleAttrValueName,value:`${o==null?void 0:o.id}:${v==null?void 0:v.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1}),e(L,{ref_key:"imgInfoListRef",ref:C,data:x.value,class:"table_css",border:"",stripe:""},{default:a(()=>[e(b,{type:"selection",width:"100",align:"center"}),e(b,{label:"图片",prop:""},{default:a(({row:o})=>[E("img",{class:"img_css",src:o.imgUrl,alt:"图片显示失败"},null,8,Ue)]),_:1}),e(b,{label:"名字",prop:"imgName"}),e(b,{label:"操作"},{default:a(({row:o})=>[e(g,{type:"primary",onClick:q=>R(o)},{default:a(()=>[B("设置为默认图片")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(g,{type:"primary",onClick:P},{default:a(()=>[B("保存")]),_:1}),e(g,{onClick:i[4]||(i[4]=o=>z(1))},{default:a(()=>[B("取消")]),_:1})]),_:1})]),_:1})}}});const Ie=ee(Ce,[["__scopeId","data-v-a7411637"]]),Pe={style:{"margin-left":"12px"}},Ne=["src"],De={name:"Spu"},$e=J({...De,setup(le,{expose:M}){const G=ue(),{category:V}=fe(G),D=f(),$=f(),x=f(1);function u(_,s){var b,g;x.value=_,s=="reqInfo"&&i(l.value.page,l.value.limit,V.value.category3),_==2&&((b=D.value)==null||b.getParentData(s)),_==3&&((g=$.value)==null||g.getParentData(V.value.category1,V.value.category2,s))}const C=f(!1),R=f();function z(_){F(()=>y.product.spu.reqLookSku(_.id),async s=>{await(R.value=s.data),C.value=!0})}function P(_){F(()=>y.product.spu.reqDelSpu(_.id),async()=>{var s;((s=S.value.records)==null?void 0:s.length)==1&&l.value.page>1&&l.value.page--,await H.success("删除成功"),i(l.value.page,l.value.limit,V.value.category3)})}ge(()=>V.value.category3,_=>{_!=""?i(l.value.page,l.value.limit,_):(l.value.total=0,S.value.records=[])});const S=f({records:[]});function i(_,s,b){F(()=>y.product.spu.reqGetSpuList(_,s,b),g=>{S.value=g.data,l.value.total=g.data.total})}const l=f({page:1,total:0,limit:3});function p(){l.value.page=1,i(l.value.page,l.value.limit,V.value.category3)}function A(){i(l.value.page,l.value.limit,V.value.category3)}return Se(()=>{G.$reset()}),M({pagination:l,reqGetSpuList:i}),(_,s)=>{const b=r("Category"),g=r("el-button"),L=r("el-table-column"),o=r("el-popconfirm"),q=r("el-table"),v=r("el-pagination"),T=r("el-card"),n=r("el-dialog"),t=ne("my-show-button");return m(),w("div",null,[e(b,{showPage:x.value,AttrReq:!1},null,8,["showPage"]),e(T,{shadow:"always",style:{"margin-top":"15px"}},{default:a(()=>[N(E("div",null,[N((m(),U(g,{disabled:!I(V).category3,type:"primary",icon:I(W),onClick:s[0]||(s[0]=d=>u(2))},{default:a(()=>[B("添加SPU")]),_:1},8,["disabled","icon"])),[[t,"btn.Spu.add"]]),e(q,{class:"table_css",data:S.value.records,border:"",stripe:""},{default:a(()=>[e(L,{type:"index",label:"序号",width:"100",align:"center"}),e(L,{prop:"spuName",label:"SPU名字"}),e(L,{prop:"description",label:"SPU描述","show-overflow-tooltip":""}),e(L,{label:"操作"},{default:a(({row:d})=>[N(e(g,{type:"primary",icon:I(W),onClick:k=>u(3,d)},null,8,["icon","onClick"]),[[t,"btn.Spu.addsku"]]),N(e(g,{type:"warning",icon:I(be),onClick:k=>u(2,d)},null,8,["icon","onClick"]),[[t,"btn.Spu.update"]]),N(e(g,{type:"info",icon:I(ye),onClick:k=>z(d)},null,8,["icon","onClick"]),[[t,"btn.Spu.skus"]]),N((m(),w("span",Pe,[e(o,{title:`确定要删除 ${d.spuName} ?`,onConfirm:k=>P(d),confirmButtonType:"primary",cancelButtonType:"text",width:"200px",icon:I(ke),iconColor:"#f90"},{reference:a(()=>[e(g,{type:"danger",icon:I(oe)},null,8,["icon"])]),_:2},1032,["title","onConfirm","icon"])])),[[t,"btn.Spu.delete"]])]),_:1})]),_:1},8,["data"]),N(e(v,{total:l.value.total,currentPage:l.value.page,"onUpdate:currentPage":s[1]||(s[1]=d=>l.value.page=d),"page-size":l.value.limit,"onUpdate:pageSize":s[2]||(s[2]=d=>l.value.limit=d),"page-sizes":[3,5,7],"pager-count":7,background:"",layout:"  prev, pager, next, jumper,->, sizes, total,",onSizeChange:p,onCurrentChange:A},null,8,["total","currentPage","page-size"]),[[Z,l.value.total>3]])],512),[[Z,x.value==1]]),N(E("div",null,[e(he,{ref_key:"SpuFormRef",ref:D,onChangeShowPage:u},null,512)],512),[[Z,x.value==2]]),N(E("div",null,[e(Ie,{ref_key:"SkuFormRef",ref:$,onChangeShowPage:u},null,512)],512),[[Z,x.value==3]])]),_:1}),e(n,{title:"SKU列表",modelValue:C.value,"onUpdate:modelValue":s[3]||(s[3]=d=>C.value=d),width:"800px"},{default:a(()=>[e(q,{data:R.value,border:"",stripe:""},{default:a(()=>[e(L,{prop:"skuName",label:"sku名字"}),e(L,{prop:"price",label:"sku价格"}),e(L,{prop:"weight",label:"sku重量"}),e(L,{label:"sku图片"},{default:a(({row:d})=>[E("img",{style:{width:"100px","min-height":"100px",display:"block"},src:d.skuDefaultImg,alt:"图片显示失败"},null,8,Ne)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}});const we=ee($e,[["__scopeId","data-v-84d46546"]]);export{we as default};
