import{d as se,G as re,i,N as h,$ as w,r as p,K as ie,o as f,c as B,h as l,w as a,x as d,a as de,y as U,g as k,u as I,O as pe,P as ce,Q as me,z as ve,b as fe,F as _e,f as ge,t as be,n as O,M as V,_ as he}from"./index-7f2c2fc1.js";const we={style:{"margin-left":"12px"}},Ue={name:"acl"},ke=se({...Ue,setup(Ve){re(()=>{m(u.value.page,u.value.limit)});const C=i("");function j(){m(1,u.value.limit)}function G(){C.value="",O(()=>{m(1,u.value.limit)})}function m(o,e,t=C.value){h(()=>w.acl.user.reqUserlist(o,e,t),s=>{u.value.total=s.data.total,L.value=s.data})}const L=i(),P=i([]);function K(o){P.value=o}function Q(){if(confirm("你确定要删除这些用户吗？？")){const e=P.value.reduce((t,s)=>(t.push(s.id),t),[]);h(()=>w.acl.user.reqBatchDelUser(e),()=>{V.success("批量删除成功"),m(u.value.page,u.value.limit)})}}function H(o){h(()=>w.acl.user.reqDelUser(o.id),()=>{V.success("用户删除成功"),m(u.value.page,u.value.limit)})}const y=i(!1),r=i({id:void 0,username:"",name:"",password:""}),R=i(),J=i({username:[{validator:(o,e,t)=>{e.trim().length<5?t(new Error("长度必须在5个以上")):t()}}],name:[{validator:(o,e,t)=>{e.trim().length<5?t(new Error("长度必须在5个以上")):t()}}],password:[{validator:(o,e,t)=>{e.trim().length<5?t(new Error("长度必须在5个以上")):t()}}]});function N(o){r.value={id:void 0,username:"",name:"",password:""},y.value=!0,O(()=>{var e;(e=R.value)==null||e.resetFields(),o!=null&&o.id&&(r.value.id=o.id,r.value.name=o.name,r.value.username=o.username,r.value.password=void 0)})}function W(){y.value=!1}function X(o){o&&o.validate(e=>{e?h(()=>w.acl.user.reqAddAndUpdateUser(r.value),()=>{r.value.id?V.success("更新用户成功"):V.success("添加用户成功"),m(u.value.page,u.value.limit),y.value=!1,location.reload()}):V.error("表单有误，请检查")})}const F=i(!1),_=i({}),z=i(!1),$=i(!1),b=i([]),x=i([]);function Y(o){$.value=!1,b.value=o?x.value.reduce((e,t)=>(t!=null&&t.id&&e.push(t==null?void 0:t.id),e),[]):[]}function D(o){const e=o.length;z.value=e==x.value.length,$.value=e>0&&e<x.value.length}function Z(o){h(()=>w.acl.user.reqRoleUserlist(o.id),e=>{b.value=e==null?void 0:e.data.assignRoles.reduce((t,s)=>(s!=null&&s.id&&t.push(s==null?void 0:s.id),t),[]),x.value=e.data.allRolesList,F.value=!0,_.value.username=o.username,_.value.userId=o.id,_.value.roleIdList=[],D(b.value)})}function ee(){_.value.roleIdList=b.value,h(()=>w.acl.user.reqSaveRoleUserlist(_.value),()=>{V.success("角色分配成功"),F.value=!1,m(u.value.page,u.value.limit)})}const u=i({page:1,total:0,limit:5});function le(){u.value.page=1,m(u.value.page,u.value.limit)}function ae(){m(u.value.page,u.value.limit)}return(o,e)=>{const t=p("el-input"),s=p("el-form-item"),c=p("el-button"),q=p("el-form"),S=p("el-card"),v=p("el-table-column"),te=p("el-popconfirm"),oe=p("el-table"),ne=p("el-pagination"),E=p("el-drawer"),T=p("el-checkbox"),ue=p("el-checkbox-group"),A=ie("my-show-button");return f(),B("div",null,[l(S,{shadow:"always"},{default:a(()=>[l(q,{class:"user_hader_card",inline:!0},{default:a(()=>[l(s,{label:"用户名字 :"},{default:a(()=>[l(t,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=n=>C.value=n)},null,8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(c,{disabled:!C.value,type:"primary",onClick:j},{default:a(()=>[d("搜索")]),_:1},8,["disabled"]),l(c,{onClick:G},{default:a(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(S,{style:{"margin-top":"15px"},shadow:"always"},{default:a(()=>{var n;return[de("div",null,[U((f(),k(c,{type:"primary",onClick:e[1]||(e[1]=g=>N())},{default:a(()=>[d("添加")]),_:1})),[[A,"btn.User.add"]]),U((f(),k(c,{type:"danger",onClick:Q,disabled:P.value.length==0},{default:a(()=>[d("批量删除")]),_:1},8,["disabled"])),[[A,"btn.User.remove"]])]),l(oe,{data:(n=L.value)==null?void 0:n.records,class:"table_css",border:"",stripe:"",onSelectionChange:K},{default:a(()=>[l(v,{type:"selection",width:"40"}),l(v,{type:"index",label:"#",align:"center","min-width":"100px"}),l(v,{prop:"id",label:"id","min-width":"100px"}),l(v,{prop:"username",label:"用户名字","min-width":"100px","show-overflow-tooltip":""}),l(v,{prop:"name",label:"用户昵称","min-width":"100px","show-overflow-tooltip":""}),l(v,{prop:"roleName",label:"用户角色","min-width":"100px","show-overflow-tooltip":""}),l(v,{prop:"createTime",label:"创建时间","min-width":"100px","show-overflow-tooltip":""}),l(v,{prop:"updateTime",label:"更新时间","min-width":"100px","show-overflow-tooltip":""}),l(v,{label:"操作",fixed:"right",width:"350px"},{default:a(({row:g})=>[U((f(),k(c,{type:"primary",icon:I(pe),onClick:M=>Z(g)},{default:a(()=>[d("分配角色")]),_:2},1032,["icon","onClick"])),[[A,"btn.User.assgin"]]),U((f(),k(c,{type:"warning",icon:I(ce),onClick:M=>N(g)},{default:a(()=>[d("编辑")]),_:2},1032,["icon","onClick"])),[[A,"btn.User.update"]]),U((f(),B("span",we,[l(te,{title:`确定要删除 ${g.username} ?`,onConfirm:M=>H(g),width:"250px"},{reference:a(()=>[l(c,{type:"danger",icon:I(me)},{default:a(()=>[d("删除")]),_:1},8,["icon"])]),_:2},1032,["title","onConfirm"])])),[[A,"btn.User.remove"]])]),_:1})]),_:1},8,["data"]),U(l(ne,{onSizeChange:le,onCurrentChange:ae,total:u.value.total,currentPage:u.value.page,"onUpdate:currentPage":e[2]||(e[2]=g=>u.value.page=g),"page-size":u.value.limit,"page-sizes":[5,7,10],layout:" prev, pager, next, jumper, ->, sizes, total",background:""},null,8,["total","currentPage","page-size"]),[[ve,u.value.total>5]])]}),_:1}),l(E,{title:r.value.id?"更新用户":"添加用户",modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=n=>y.value=n),direction:"rtl",size:"500px","show-close":!0},{footer:a(()=>[l(c,{onClick:W},{default:a(()=>[d("取消")]),_:1}),l(c,{type:"primary",onClick:e[6]||(e[6]=n=>X(R.value))},{default:a(()=>[d("确定")]),_:1})]),default:a(()=>[l(q,{model:r.value,ref_key:"userFormRef",ref:R,rules:J.value,inline:!1},{default:a(()=>[l(s,{label:"用户名字",prop:"username"},{default:a(()=>[l(t,{modelValue:r.value.username,"onUpdate:modelValue":e[3]||(e[3]=n=>r.value.username=n),placeholder:"请填写用户名字"},null,8,["modelValue"])]),_:1}),l(s,{label:"用户昵称",prop:"name"},{default:a(()=>[l(t,{modelValue:r.value.name,"onUpdate:modelValue":e[4]||(e[4]=n=>r.value.name=n),placeholder:"请填写用户昵称"},null,8,["modelValue"])]),_:1}),r.value.id?fe("",!0):(f(),k(s,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(t,{modelValue:r.value.password,"onUpdate:modelValue":e[5]||(e[5]=n=>r.value.password=n),placeholder:"请填写用户密码"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(E,{title:"分配用户角色",modelValue:F.value,"onUpdate:modelValue":e[12]||(e[12]=n=>F.value=n),direction:"rtl",size:"500px","show-close":!0},{footer:a(()=>[l(c,{onClick:e[11]||(e[11]=n=>F.value=!1)},{default:a(()=>[d("取消")]),_:1}),l(c,{type:"primary",onClick:ee},{default:a(()=>[d("确定")]),_:1})]),default:a(()=>[l(q,{inline:!1,"label-width":"80px"},{default:a(()=>[l(s,{label:"用户姓名"},{default:a(()=>[l(t,{disabled:!0,modelValue:_.value.username,"onUpdate:modelValue":e[8]||(e[8]=n=>_.value.username=n)},null,8,["modelValue"])]),_:1}),l(s,{label:"角色列表"},{default:a(()=>[l(T,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=n=>z.value=n),indeterminate:$.value,onChange:Y},{default:a(()=>[d(" 全选 ")]),_:1},8,["modelValue","indeterminate"])]),_:1}),l(s,null,{default:a(()=>[l(ue,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=n=>b.value=n),onChange:D},{default:a(()=>[(f(!0),B(_e,null,ge(x.value,n=>(f(),k(T,{key:n.id,label:n.id},{default:a(()=>[d(be(n.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const Ae=he(ke,[["__scopeId","data-v-e403ec69"]]);export{Ae as default};
