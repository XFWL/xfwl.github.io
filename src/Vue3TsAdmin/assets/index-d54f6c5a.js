import{d as Y,V as Z,m as ee,i as m,H as te,r as i,K as S,o as _,c as N,h as e,w as l,y as f,a as B,g as h,u as d,R as F,x as p,F as ae,f as le,t as $,P as ne,W as oe,Q as D,z as P,N as R,M as L,$ as E,_ as re}from"./index-7f2c2fc1.js";const se={style:{"margin-left":"12px"}},ue=["onClick"],ie={name:"Attr"},ce=Y({...ie,setup(de){const v=Z(),{category:k,attrInfoList:U}=ee(v);function q(o){R(()=>E.product.attr.reqDeleteAttr(o.id),async()=>{v.category3Change(),L.success("删除成功")})}const g=m(1);function y(o,t){var s;if(g.value=o,o==2&&(a.value={attrName:"",categoryLevel:3,attrValueList:[]},(s=w.value)==null||s.clearValidate("attrName")),t){const r=JSON.parse(JSON.stringify(t));a.value=r,x.value=r.attrValueList}}const a=m({attrName:"",categoryLevel:3,attrValueList:[]}),x=m(),w=m(),O=m({attrName:[{validator:(o,t,s)=>{t==""&&s(new Error("请输入属性名字"))},trigger:"blur"}]});function z(){var t;((t=a.value.attrValueList.at(-1))==null?void 0:t.valueName)==""||a.value.attrValueList.push({valueName:"",isInput:!0})}function J(){a.value.attrValueList=x.value}function M(o){a.value.attrValueList.splice(o,1)}function T(o,t,s){if(t.valueName==""){a.value.attrValueList.splice(s,1);return}a.value.attrValueList.find(u=>{if(u!=t)return u.valueName==t.valueName})?(L.info("不能有重复的属性"),a.value.attrValueList.splice(s,1)):t.isInput=!1}function j(o){o.isInput=!0}function H(){const o=a.value.attrValueList.filter(s=>(s.isInput=void 0,!0)),t=Object.assign({},a.value,{attrValueList:o});t.categoryId=k.value.category3,R(()=>E.product.attr.reqSaveAttrInfo(t),async()=>{t.id?L.success("更新成功"):L.success("添加成功"),await y(1),v.category3Change()})}return te(()=>{v.$reset()}),(o,t)=>{const s=i("Category"),r=i("el-button"),u=i("el-table-column"),K=i("el-tag"),Q=i("el-popconfirm"),A=i("el-table"),I=i("el-input"),b=i("el-form-item"),W=i("el-form"),G=i("el-card"),C=S("my-show-button"),X=S("my-focus");return _(),N("div",null,[e(s,{showPage:g.value},null,8,["showPage"]),e(G,{shadow:"always",style:{"margin-top":"15px"}},{default:l(()=>[f(B("div",null,[f((_(),h(r,{disabled:!d(k).category3,type:"primary",size:"default",icon:d(F),onClick:t[0]||(t[0]=n=>y(2))},{default:l(()=>[p("添加平台属性")]),_:1},8,["disabled","icon"])),[[C,"btn.Attr.add"]]),e(A,{class:"table_css",data:d(U),border:"",stripe:"",style:{"margin-top":"15px"}},{default:l(()=>[e(u,{type:"index",label:"序号",width:"100px",align:"center"}),e(u,{prop:"attrName",label:"属性名字",width:"300px"}),e(u,{label:"属性值名字"},{default:l(({row:n})=>[(_(!0),N(ae,null,le(n.attrValueList,c=>(_(),h(K,{style:{margin:"5px"},type:"danger",effect:"light"},{default:l(()=>[p($(c.valueName),1)]),_:2},1024))),256))]),_:1}),e(u,{label:"操作",width:"200px"},{default:l(({row:n})=>[f(e(r,{type:"warning",icon:d(ne),onClick:c=>y(2,n)},null,8,["icon","onClick"]),[[C,"btn.Attr.update"]]),f((_(),N("span",se,[e(Q,{icon:d(oe),title:`确定要删除 ${n.attrName} ？`,onConfirm:c=>q(n),width:"250px"},{reference:l(()=>[e(r,{type:"danger",icon:d(D)},null,8,["icon"])]),_:2},1032,["icon","title","onConfirm"])])),[[C,"btn.Attr.remove"]])]),_:1})]),_:1},8,["data"])],512),[[P,g.value==1]]),f(B("div",null,[e(W,{model:a.value,ref_key:"attrFormRef",ref:w,rules:O.value,inline:!0},{default:l(()=>[e(b,{label:"属性名字",porp:"attrName",prop:"attrName"},{default:l(()=>[e(I,{placeholder:"请输入属性的名字",modelValue:a.value.attrName,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.attrName=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),e(b,null,{default:l(()=>[e(r,{disabled:!a.value.attrName,icon:d(F),type:"primary",onClick:z},{default:l(()=>[p("添加属性值")]),_:1},8,["disabled","icon"]),e(r,{onClick:J},{default:l(()=>[p("取消")]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(A,{data:a.value.attrValueList,border:"",stripe:""},{default:l(()=>[e(u,{type:"index",label:"序号",width:"100",align:"center"}),e(u,{label:"属性"},{default:l(({row:n,$index:c})=>[n.isInput?f((_(),h(I,{key:0,modelValue:a.value.attrValueList[c].valueName,"onUpdate:modelValue":V=>a.value.attrValueList[c].valueName=V,onBlur:V=>T(V,n,c)},null,8,["modelValue","onUpdate:modelValue","onBlur"])),[[X]]):(_(),N("div",{key:1,onClick:V=>j(n)},$(a.value.attrValueList[c].valueName),9,ue))]),_:1}),e(u,{label:"操作"},{default:l(({$index:n})=>[e(r,{icon:d(D),type:"danger",onClick:c=>M(n)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(b,null,{default:l(()=>[e(r,{disabled:a.value.attrValueList.length==0,type:"primary",onClick:H},{default:l(()=>[p("保存")]),_:1},8,["disabled"]),e(r,{onClick:t[2]||(t[2]=n=>y(1))},{default:l(()=>[p("取消")]),_:1})]),_:1})],512),[[P,g.value==2]])]),_:1})])}}});const pe=re(ce,[["__scopeId","data-v-6ef2dbb1"]]);export{pe as default};
